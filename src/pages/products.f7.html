<template>
<div class="page" data-name="products">
  <div class="navbar">
    <div class="navbar navbar-bg"></div>
    <div class="navbar-inner sliding">
      <div class="left">
        <a href="#" class="link back">
          <i class="icon icon-back"></i>
          <span class="if-not-md">Back</span>
        </a>
      </div>
      <div class="title padding-vertical-half">Products</div>
      <div class="right">
        <a href="#" class="link icon-only panel-toggle" data-panel="left">
          <i class="icon f7-icons if-not-md">menu</i>
          <i class="icon material-icons if-md">menu</i>
        </a>
      </div>
    </div>
  </div>

    <!--fab-->
    <div class="fab fab-extended fab-right-bottom">
      <a href="#" @click="openPopUp(null)">
        <i class="icon f7-icons">plus</i>
        <!-- Element with FAB text  -->
        <div class="fab-text">Product</div>
      </a>
    </div>
    <!--fab-->

  <div class="page-content">

    <div class="block no-margin-vertical no-margin-horizontal no-padding-vertical roundHolder no-padding-horizontal">
      <div id="product-list" class="customList">
        <div class="text-align-center">
          <!--<input class="search" placeholder="search">-->
          <!-- Additional "searchbar-inline" class -->
          <div class="searchbar searchbar-inline">
            <div class="searchbar-input-wrap">
              <input type="search" placeholder="Search" class="search">
              <i class="searchbar-icon"></i>
              <span class="input-clear-button"></span>
            </div>
          </div>

          <div class="margin-vertical-half padding-vertical-half sortTextPar">
            <span class="sortText display-none">Sort By:</span>
            <!--<span class="sort" data-sort="name">Name</span>
            <span class="sort" data-sort="cost">Cost</span>-->
          </div>
        </div>

        <div class="row margin-top-half myToolbar">
          <div class="col-50 no-padding-vertical">
            <span class="margin-left-half">You have {{totalMat}} {{js "this.totalMat > 1 ? 'products' : 'product'"}}</span>
          </div>
          <div class="col-50 no-padding-vertical text-align-right">
            <span class="display-inline-flex margin-right-half">
              <span class="item-title float-right">Show Deleted</span>
              <span class="item-after float-right margin-left-half">
                  <label class="toggle toggle-init color-red showInactive">
                  <input type="checkbox">
                  <span class="toggle-icon"></span>
                  </label>
              </span>
              </span>
          </div>
        </div>
          <ul class="list sortList margin-vertical-half">
            
          </ul>
          <!--<ul class="pagination"></ul>-->
        </div>
      </div>
    </div>
  <!--</div>-->

  <!--pop up add new product-->
  <div class="popup newProduct popup-tablet-fullscreen">
    <div class="view">
      <div class="page">
        <div class="navbar">
          <div class="navbar-bg"></div>
          <div class="navbar-inner">
            <div class="title">Add/Edit Product</div>
            <div class="right">
              <!-- Link to close popup -->
              <a class="link" @click="closeEditProdPopUp"><i class="icon f7-icons">multiply</i>Close</a>
            </div>
          </div>
        </div>
        <div class="page-content">
            <div class="list no-hairlines-md margin-top-half margin-bottom-half productForm">
              <ul>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Product Name</div>
                      <div class="item-input-wrap">
                        <input type="text" class="name" placeholder="Product name" required validate/>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Product Description</div>
                      <div class="item-input-wrap">
                        <!--<input type="text" class="desc_of_product" placeholder="Description of product"/>
                        <span class="input-clear-button"></span>-->
                        <div class="text-editor desc_of_product margin-top-half" data-placeholder="Description of product" 
                          data-buttons='[["bold", "italic", "underline", "strikeThrough"], ["orderedList", "unorderedList"]]'>
                          <div class="text-editor-content" contenteditable></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Cost Price</div>
                      <div class="item-input-wrap">
                        <input type="text" class="cost_price" placeholder="Cost price of product" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Selling Price</div>
                      <div class="item-input-wrap">
                        <input type="text" class="selling_price" placeholder="Selling price of product" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-inner">
                      <a href="#" class="col button button-outline button-raised mainButton" @click='saveData'>Save Product</a>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
  
  </div>
  <!--Pop -up-->

    <!--pop up make a sale-->
  <div class="popup sellProduct popup-tablet-fullscreen">
    <div class="view">
      <div class="page">
        <div class="navbar">
          <div class="navbar-bg"></div>
          <div class="navbar-inner">
            <div class="title">Sell Product</div>
            <div class="right">
              <!-- Link to close popup -->
              <a class="link" @click="resetSalePopUp"><i class="icon f7-icons">multiply</i>Close</a>
            </div>
          </div>
        </div>
        <div class="page-content">
            <div class="list no-hairlines-md margin-top-half margin-bottom-half">
              <ul>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Product Name</div>
                      <div class="item-input-wrap">
                        <input type="text" class="name_sell" placeholder="Product name" required/>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="row">
                      <div class="col-50">
                        <div class="item-content item-input">
                          <div class="item-inner">
                            <div class="item-title">Selling Price</div>
                            <div class="item-input-wrap">
                              <input type="text" class="cost_sell" @keyup="calculateQuantity" placeholder="selling price" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                              <span class="input-clear-button"></span>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-50">
                        <div class="item-content item-input">
                          <div class="item-inner">
                            <div class="item-title">Quantity</div>
                            <div class="item-input-wrap">
                              <input type="text" class="quantity_sell" @keyup="calculateQuantity" placeholder="Quantity" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                              <span class="input-clear-button"></span>
                            </div>
                          </div>
                        </div>
                      </div>
                  </div>
                  
                </li>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Discount</div>
                      <div class="item-input-wrap">
                        <input type="text" class="discount_sell" @keyup="calculateQuantity" value="0" placeholder="Discount" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Total Price</div>
                      <div class="item-input-wrap">
                        <input type="text" class="total_sell" @keyup="calculateQuantity2" placeholder="Total Price" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="row">
                      <div class="col-50">
                        <div class="item-content item-input">
                          <div class="item-inner">
                            <div class="item-title">Taxes in %</div>
                            <div class="item-input-wrap">
                              <input type="text" class="taxes" @keyup="calculateQuantity" placeholder="Taxes in %" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                              <span class="input-clear-button"></span>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-50">
                        <div class="item-content item-input">
                          <div class="item-inner">
                            <div class="item-title">After Tax Price</div>
                            <div class="item-input-wrap">
                              <input type="text" class="afterTax" placeholder="After Tax Price"/>
                              <span class="input-clear-button"></span>
                            </div>
                          </div>
                        </div>
                      </div>
                  </div>
                  
                </li>
                <li>
                  <div class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title">Buyer's Name</div>
                      <div class="item-input-wrap">
                        <input type="text" class="buyer_sell" id="buyer_sell" placeholder="Buyer's name" required/>
                        <span class="input-clear-button"></span>
                      </div>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="row">
                    <div class="col-50">
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title">Amount Paid</div>
                          <div class="item-input-wrap">
                            <input type="text" class="amountpaid_sell" placeholder="Amount customer paid" value="0" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" data-error-message="Only numbers and decimals please!"/>
                            <span class="input-clear-button"></span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="col-50">
                      <div class="item-content item-input">
                        <div class="item-inner">
                          <div class="item-title">It's an Estimate<i class="icon f7-icons icon-tooltip estimateExplain color-black">info_circle_fill</i></div>
                          <div class="item-input-wrap">
                            <label class="checkbox">
                              <!-- checkbox input -->
                              <input type="checkbox" class="isEstimate">
                              <!-- checkbox icon -->
                              <i class="icon-checkbox"></i>
                            </label>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
                </li>
                <li>
                  <div class="item-content item-input">
                      <div class="item-inner">
                        <div class="item-title">Date Buyer Paid</div>
                      <div class="item-input-wrap">
                          <input type="text" placeholder="Date buyer paid" id="paid-calendar-modal"/>
                          <span class="input-clear-button"></span>
                      </div>
                      </div>
                  </div>
                </li>
                <li>
                  <div class="item-content item-input">
                      <div class="item-inner">
                        <div class="item-title">Date of Purchase</div>
                      <div class="item-input-wrap">
                          <input type="text" placeholder="Date of purchase" id="purchase-calendar-modal" required validate data-error-message="Select date of purchase please!"/>
                          <span class="input-clear-button"></span>
                      </div>
                      </div>
                  </div>
                </li>
                <li>
                  <div class="item-content">
                    <div class="item-inner">
                      <a href="#" class="col button button-outline button-raised mainButton" @click='saveDataSell'>Sell Product</a>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
  
  </div>
  <!--pop up make a sale-->

  <!--pop up for add ingredients-->
  <div class="popup ProductIngredients popup-tablet-fullscreen">
    <div class="view">
      <div class="page">
        <div class="navbar">
          <div class="navbar-bg"></div>
          <div class="navbar-inner">
            <div class="title">Add/Edit Product Raw Materials</div>
            <div class="right">
              <!-- Link to close popup -->
              <a class="link" @click="closePopUp"><i class="icon f7-icons">multiply</i>Close</a>
            </div>
          </div>
        </div>
        <div class="page-content">
            <div class="block margin-top-half margin-bottom-half padding-horizontal-half">
                  <div class="block-title block-title-medium no-margin-bottom">{{productToEdit}}</div>
            </div>

        <div class="list margin-bottom-half no-margin-top">
          <div class="block-header text-color-black no-margin-bottom margin-top-half text-align-center">Select Raw Materials Below - select multiple</div>
          <div class="margin-horizontal-half">
            <a class="col button button-outline button-raised" href="#" id="autocomplete-standalone-multiple">
            <div class="item-title text-color-blue btn-blue">Add Raw Materials</div>
          </a>
        </div>
          <!--<ul>
            <li>
              <a class="item-link item-content bg-color-orange myOrange" href="#" id="autocomplete-standalone-multiple">
                <input type="hidden">
                <div class="item-inner">
                  <div class="block-title item-title no-margin text-color-white">Add Raw Materials</div>
                  <div class="item-after"></div>
                </div>
              </a>
            </li>
          </ul>-->
        </div>

        <div id="prodIng-list" class="customList">
          <ul class="list sortList margin-top-half margin-bottom-half">
            
          </ul>
          <!--<ul class="pagination"></ul>-->
        </div>

        <div class="margin-horizontal-half">
          <a class="button button-raised button-fill color-blue customcharges" @click="AddNewCost">Add Custom Charges</a>
        </div>

        <div id="prodOtherIng-list" class="customList">
          <ul class="list sortList margin-top-half margin-bottom-half">
            
          </ul>
          <!--<ul class="pagination"></ul>-->
        </div>

        <ul class="list sortList margin-top-half margin-bottom-half">
          <div class="card myCard">
            <div class="card-content padding-horizontal-half">
              <!--<div><span class="labelName">Add Profit in %:</span>
                <div class="display-inline-flex">
                  <input class="profitpercent" type="text" placeholder="profit 0 to 100" @keyup="calculateprofit" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" value="0">
                </div></div>-->
                <div><span class="labelName">Profit in Money:</span>
                  <div class="display-inline-flex">
                    <input class="profitvalue" type="text" @keyup="calculateprofit">
                    <!--<div class="profitvalue valueName"></div>-->
                  </div></div>
            </div>
          </div>
      </ul>

      <div class="margin-top-half bigLabel margin-horizontal-half">
        <span class="labelName">Cost before profit: </span>
        <div class="display-inline-flex"><div class="totalAmountBeforeProfit">0</div></div>
      </div>
      <div class="margin-top-half bigLabel margin-horizontal-half">
        <span class="labelName">Cost after profit: </span>
        <div class="display-inline-flex"><div class="totalAmount">0</div></div>
      </div>

      <div class="row padding-horizontal-half margin-bottom-half"><div class="col-50">
        <a class="col button button-outline button-raised mainButton calculateTotalButton" @click="CalculateTotal">Calculate</a>
      </div>
      <div class="col-50">
            <a class="col button button-outline button-raised mainButton saveTotalButton" @click="SaveTotal">Save</a>
      </div>
    </div>
        
            
        </div>
      </div>
    </div>
  
  </div>
  <!--Pop -up for add ingredients-->

  
  <!--pop up for for multiple items-->
  <div class="popup multipleSales popup-tablet-fullscreen">
    <div class="view">
      <div class="page">
        <div class="navbar">
          <div class="navbar-bg"></div>
          <div class="navbar-inner">
            <div class="title">Multiple Product Sales</div>
            <div class="right">
              <!-- Link to close popup -->
              <a class="link" @click="closePopUpMultiple"><i class="icon f7-icons">multiply</i>Close</a>
            </div>
          </div>
        </div>
        <div class="page-content">
            
        <div class="list margin-bottom-half no-margin-top">
          <div class="block-header text-color-black no-margin-bottom margin-top text-align-center">Select Products Below - select multiple</div>
          <div class="margin-horizontal-half">
            <a class="col button button-outline button-raised" href="#" id="autocomplete-standalone-multiple2">
            <div class="item-title text-color-blue btn-blue">Add Products</div>
          </a>
        </div>
          <!--<ul>
            <li>
              <a class="item-link item-content bg-color-orange myOrange" href="#" id="autocomplete-standalone-multiple2">
                <input type="hidden">
                <div class="item-inner">
                  <div class="block-title item-title no-margin text-color-white">Add Products</div>
                  <div class="item-after"></div>
                </div>
              </a>
            </li>
          </ul>-->
        </div>

        <div id="products-list" class="customList">
          <ul class="list sortList margin-top-half margin-bottom-half">
            
          </ul>
          <!--<ul class="pagination"></ul>-->
        </div>

        <div class="margin-horizontal-half">
          <a class="button button-raised button-fill color-blue customcharges" @click="AddNewProduct(null)">Add Custom Products</a>
        </div>

        <div id="productsOther-list" class="customList">
          <ul class="list sortList margin-top-half margin-bottom-half">
            
          </ul>
          <!--<ul class="pagination"></ul>-->
        </div>

        <ul class="list sortList margin-top-half margin-bottom-half">
          <div class="card myCard">
            <div class="card-content padding-horizontal-half">
              <div><span class="labelName">Taxes in %:</span>
                <div class="display-inline-flex">
                  <input class="taxpercent" type="text" placeholder="0 to 100" @keyup="CalculateTotalProduct" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" value="0">
                </div></div>
            </div>
          </div>
      </ul>
      <div class="row padding-horizontal-half"><div class="col-100">
        <a class="col button button-outline button-raised mainButton calculateTotalButton" @click="CalculateTotalProduct">Calculate</a>
      </div>
    </div>
        <div class="margin-top-half bigLabel text-align-center margin-horizontal-half">
          <span class="labelName">Cost before Tax: </span>
          <div class="display-inline-flex"><div class="totalAmountBeforeProfitProduct">0</div></div>
        </div>
        <div class="margin-top-half bigLabel text-align-center margin-horizontal-half">
          <span class="labelName">Cost after Tax: </span>
          <div class="display-inline-flex"><div class="totalAmountProduct">0</div></div>
        </div>
         
        <ul class="list margin-top-half margin-bottom-half grouped"><li>
        <div class="card myCard">
          <div class="card-content padding-horizontal-half" style="font-size: 1.15em;">
            <div><span class="labelName">Grouped Name: </span><div class="display-inline-flex">
              <input class="groupProductNameMultiple" type="text" placeholder="Give Group Name" value=""></div></div>
            <div><span class="labelName">Buyer's Name: </span><div class="display-inline-flex">
              <input class="buyersNameMultiple" id="buyersNameMultiple" type="text" placeholder="Buyer's Name" value=""></div></div>
            
              <div>
                <span class="labelName">It's an Estimate<i class="icon f7-icons icon-tooltip estimateExplain color-black">info_circle_fill</i></span>
                <div class="display-inline-flex" style="vertical-align: bottom;">
                  <div class="item-input-wrap" style="position: relative;">
                    <label class="checkbox" style="position: absolute;bottom: 4px;">
                      <input type="checkbox" class="isEstimateMultiple">
                      <i class="icon-checkbox"></i>
                    </label>
                  </div>
              </div></div>
            
            <div><span class="labelName">Amount Paid: </span><div class="display-inline-flex">
                <input class="amountPaidMultiple" type="text" placeholder="Amount Paid" value="0"></div></div>
            <div><span class="labelName">Date of Payment: </span><div class="display-inline-flex" style="width:100%">
                  <input id="datePaidMultiple" class="text-align-center" type="text" placeholder="Date of Payment" value="0"></div></div>
            <div><span class="labelName">Date of Purchase: </span><div class="display-inline-flex" style="width:100%">
                    <input id="datePurchaseMultiple" class="text-align-center" type="text" placeholder="Date of Purchase" value="0"></div></div>
          </div>
        </div>
        </li></ul>
                <div class="row padding-horizontal-half"><div class="col-100">
                  <a class="col button button-outline button-raised mainButton margin-bottom-half" @click="saveMultipleProduct">Save All</a>
                </div>
              </div>
        </div>
      </div>
    </div>
  
  </div>
  <!--Pop -up for multiple items-->

</div>
</template>
<script>
//import Dom7 from 'dom7';
//import Dexie from 'dexie';
import * as moment from 'moment';
/*var db = new Dexie("BizExpenseManagerDB");
          db.version(3).stores({
            ingredients: "++id,name,unit_size,unit,cost_per_unit,status,created_date",
            products: "++id,name,cost,status,created_date",
            product_ingredient: "++id,productID,ingredientID,unit_size,cost,status,created_date",
            product_otherMaterials: "++id,productID,name,cost,status,created_date",
            sales: "++id,parentID,product_name,isParent,buyer_name,cost,quantity,tax,total_price,afterTax,amountPaid,isPaid,date_paid,created_date,status",
            expenses: "++id,name,amount_to_pay,amount_paid,date_paid,created_date,recurring,status",

            ingredients_history: "++id,ingID,name,unit_size,unit,cost_per_unit,status,created_date",
            products_history: "++id,prodID,name,cost,status,created_date",
            sales_history: "++id,salesID,product_name,buyer_name,cost,amountPaid,isPaid,date_paid,created_date,status",
            expenses_history: "++id,expID,name,amount_to_pay,amount_paid,date_paid,created_date,recurring,status"
          })*/
var dbProducts = null, dbProdIngs = null, dbProdOthers = null, dbSales = null, dbIngs = null, dbSettings = null, dbClients = null;
//var $$ = Dom7;
export default {
  data: function () {
      // Must return an object
      return {
        products: null,
        totalMat:0,
        currentProduct: null,
        totalMatIngredients:0,
        ings:null,
        allIngs:null,
        productToEdit: null,
        productToEditID: null,
        productIngs:[],
        currentMultipleSale: null,
        selectedProducts:[],
        settings: null,
        settingsID: 'settings',
        clients:null
      }
    },
  methods:{
    calculateprofit: function(){
      var self = this;
        self.CalculateTotal();
    },
    calculateQuantity: function(){
        var cost = Number($(".cost_sell").val().trim());
        var quant = Number($(".quantity_sell").val().trim());
        if(!isNaN(cost) && !isNaN(quant)){
            var total = cost * quant;
            var discount = Number($(".discount_sell").val());
            total = total - discount;
            $(".total_sell").val(total.toFixed(2));
            var taxes = Number($(".taxes").val().trim());
            //console.log("0 - " + taxes);
            if(taxes != "" || taxes == 0){
              //console.log("1 - " + taxes);
              if(!isNaN(taxes)){
                //console.log("2 - " + taxes);
                var taxAmt = (taxes/100) * total;
                var aftCost = total + taxAmt;
                //console.log("3 - " + aftCost);
                $(".afterTax").val(aftCost.toFixed(2));
              }
            }
        }
    },
    calculateQuantity2: function(){
      var self = this;
      var total = Number($(".total_sell").val());
            var taxes = Number($(".taxes").val().trim());
            //console.log("0 - " + taxes);
            if(taxes != "" || taxes == 0){
              //console.log("1 - " + taxes);
              if(!isNaN(taxes)){
                //console.log("2 - " + taxes);
                var taxAmt = (taxes/100) * total;
                var aftCost = total + taxAmt;
                //console.log("3 - " + aftCost);
                $(".afterTax").val(aftCost.toFixed(2));
              }
            }else{
              $(".afterTax").val(total.toFixed(2)); 
            }
    },
    CalculateTotal: function(){
      var totalCost = 0;
      $$(".eachCost").forEach(function(curr, i){
        var cost = 0;
        if($$(".eachCost")[i].type == "text"){
            cost = Number($$(".eachCost")[i].value);
        }else{
            cost = Number($$(".eachCost")[i].textContent);
        }
          
          if(!isNaN(cost)){
              totalCost += cost;
              //console.log(totalCost);
          }else{
              $$(".totalAmount").text("please fix error");
              return;
          }
      })
      
      //console.log(totalCost);
      /*var cent = $(".profitpercent").eq(0).val();
        if(cent != 0 && cent != "" && totalCost != ""){
          cent = Number(cent);
          var val = (cent/100) * totalCost;
          $(".profitvalue").eq(0).val(val.toFixed(2));
        }else{
          $(".profitvalue").eq(0).val("0");
        }*/
        $(".totalAmountBeforeProfit").text(totalCost.toFixed(2));
        var profitvalue = Number($(".profitvalue").eq(0).val());
        totalCost += profitvalue;
        $(".totalAmount").text(totalCost.toFixed(2));
    },
    typingvalue: function(but){
      var self = this;
      var val = $(but).val();
      var costperunit = $(but).attr("data-cost");
      var unit = $(but).attr("data-unit");
      var fig = (Number(costperunit)/Number(unit)) * Number(val);
        //console.log(fig.toFixed(2));
        var td = $(but).parents("li").eq(0).find(".eachCost").eq(0).text(fig.toFixed(2));
        self.CalculateTotal();
    },
    RemoveItem: function(but){
      var self = this;
      var id = $(but).attr("data-id");
      //console.log(id);
        var select = self.productIngs.find(function(e){ 
              return e._id == id;
          });
 
          $(but).parents("li").eq(0).remove();
          self.$setState({
                ings:self.ings,
                productIngs:self.productIngs
            }, function(){
              
              self.CalculateTotal();
            });
    },
    SelectItem: function(select){
      var self = this;
        var cpu = select.cost_per_unit == undefined ? 0 : select.cost_per_unit;
        var sus = select.select_unit_size == undefined ? 0 : select.select_unit_size; 
        var html = '<li class="eachCostParent"><div class="card myCard"><div class="card-content padding-horizontal-half">';
        html += '<div class="name cardName">' + select.name + '</div>';
        html += '<div class=""><span class="labelName">Unit Cost: </span><span class="valueName">' + self.formatMoney(cpu) + " for " + select.unit_size + select.unit + '</span></div>';
        html += '<div><span class="labelName">Quantity To Use: </span><div class="display-inline-flex align-items-center"><input class="margin-horizontal-half costvalue" type="text" placeholder="Enter Quantity" ';
        html += 'data-cost="' + cpu +'" data-unit="' + select.unit_size + '" required validate pattern="[0-9]+(\.[0-9][0-9]?)?" '; 
                //var val = sus != undefined ? select.select_unit_size : 0;
        html +=  'value="' + sus + '"><span>' + select.unit + '</span></div></div>';
        var val2 = select.select_cost != undefined ? select.select_cost : 0;
        var stat = select.status == 1 ? "display-none" : "";
        html += '<div class=""><span class="labelName">Cost of Material: </span><span class="valueName eachCost">' + val2 + '</span></div>';
        html += '<div class="' + stat + '"><span class="labelName">Status: </span><span class="valueName">Deleted</span></div>';
        html += '</div><div class="card-footerMine padding-horizontal-half padding-bottom-half"><p class="display-inline-flex no-margin-vertical">';
          html += '<a class="button button-small button-raised removeCost" data-id="' + select._id + '">Delete</a>';
        html += '</p></div></div>'
        html += '</li>';
        $("#prodIng-list .sortList").append(html);
        $(".removeCost").off("click").on("click", function(){
                  //var id = $(this).attr("data-itemid");
                  self.RemoveItem(this);
                })
                $(".costvalue").off("keyup").on("keyup", function(){
                  //var id = $(this).attr("data-itemid");
                  self.typingvalue(this);
                })
    },
    showToast: function(text, position){
        var self = this;
        self.$app.toast.create({
                        text: text,
                        position: position,
                        closeTimeout: 2000,
                        }).open();
    },
    permDeleteItem: function(list, id){
        var self = this;
        
        self.$app.dialog.confirm("Are you sure you want to permanently delete this?", function(){
                  dbProducts.get(id).then(function(doc) {
                   // console.log(doc);
                    doc.status = -1
                    return dbProducts.put(doc);
                  }).then(function(){

                  self.products = self.products.filter(function(e){ 
                      return e._id != id;
                  });
                  self.$setState({
                      products:self.products,
                      totalMat:self.products.length
                  },function(){
                      self.showToast("Product permanently deleted!", "center");
                      list.remove("id", id);
                      if(self.products.length == 0){
                        $(".sortTextPar").addClass("display-none");
                        $("#product-list .pagination").remove();
                      }
                  });
              })
          }, null);
    },
    DeleteItem: function(list, id){
        var self = this;
        var checked = 0;
        var text = "delete"
        var toggle = self.$app.toggle.get(".showInactive");
        if(toggle != undefined){
            if(toggle.checked){
                text = "activate";
                checked = 1;
            }
        }
        self.$app.dialog.confirm("Are you sure you want to " + text + "?", function(){
                  dbProducts.get(id).then(function(doc) {
                   // console.log(doc);
                    doc.status = checked
                    return dbProducts.put(doc);
                  }).then(function(){

                  self.products = self.products.filter(function(e){ 
                      return e._id != id;
                  });
                  self.$setState({
                      products:self.products,
                      totalMat:self.products.length
                  },function(){
                      self.showToast("Product " + text + "d!", "center");
                      list.remove("id", id);
                      if(self.products.length == 0){
                        $(".sortTextPar").addClass("display-none");
                        $("#product-list .pagination").remove();
                      }
                  });
              })
          }, null);
    },
    openPopUp: function(id){
        var self = this;
        
        //popup.once("opened", function(){
          if(id != null || id != undefined){
            var item = self.products.find(function(e){ 
                  return e._id == id;
              });
              self.$setState({
                      currentProduct:item
                    });
                    $$("input.name").val(item.name);
                    var textEditor = self.$app.textEditor.get('.desc_of_product');
                    var desc = item.desc == null ? "" : item.desc;
                    textEditor.setValue(desc);
                    $("input.cost_price").val(item.cost_price);
                    $$("input.selling_price").val(item.selling_price);
                    var popup = self.$app.popup.open('.newProduct', true);
            } else{
              var popup = self.$app.popup.open('.newProduct', true);
              self.$setState({
                  currentProduct:null
              });
            }
        //})
        
    },
    openPopUpSellProduct: function(id){
        var self = this;
        
        //popup.once("opened", function(){
          if(id != null || id != undefined){
            var item = self.products.find(function(e){ 
                  return e._id == id;
              });
              self.$setState({
                  currentProduct: item
              });

                $$("input.name_sell").val(item.name);
                $$("input.cost_sell").val(item.selling_price);
                var quantity = item.quantity == null ? 1 : item.quantity;
                var total = item.total_price == null ? item.selling_price : item.total_price;
                //var taxes = localStorage.getItem("taxes");
                var taxes = self.settings == null ? 0 : self.settings.taxes;
                var taxesAmt = taxes == undefined ? 0 : taxes;
                taxesAmt = Number(taxesAmt);
                total = Number(total);
                var afterTax = (((taxesAmt/100) * total) + total);
                $(".quantity_sell").val(quantity);
                $(".taxes").val(taxesAmt);
                $(".afterTax").val(afterTax.toFixed(2));
                $(".total_sell").val(total.toFixed(2));
                $("#paid-calendar-modal").val(moment().format('LLL'));
                $("#purchase-calendar-modal").val(moment().format('LLL'));
                var popup = self.$app.popup.open('.sellProduct', true);
            } else{
              var taxes = self.settings == null ? 0 : self.settings.taxes;
              var taxesAmt = taxes == undefined ? 0 : taxes;
              $(".quantity_sell").val("1");
              $(".taxes").val(taxesAmt);
              $("#paid-calendar-modal").val(moment().format('LLL'));
              $("#purchase-calendar-modal").val(moment().format('LLL'));
              var popup = self.$app.popup.open('.sellProduct', true);
              self.$setState({
                  currentProduct:null
              });
            }
        //})
        
    },
    SelectItemMultipleProducts: function(select){//name,cost,status,created_date
      var self = this;
      var name = select.product_name == null ? "" : select.product_name;
      if(name == ""){
        name = select.name == null ? "" : select.name;
      }
      var discount = select.discount == null ? "0" : select.discount;
      var cost = select.selling_price == null ? "" : select.selling_price;
      var quantity = select.quantity == null ? 1 : select.quantity;
      var totalPrice = select.total_price == null ? "" : select.total_price; 
        var html = '<li class="eachSaleParent eachProduct"><div class="card myCard"><div class="card-content padding-horizontal-half">';
          html += '<div><span class="labelName">Product Name: </span><div class="display-inline-flex"><input class="productName" type="text" placeholder="Product Name" value="';
          html +=  name + '"></div></div>';
          html += '<div class="row"><div class="col-50"><div class="item-content item-input no-padding-left"><div class="item-inner no-padding-right"><div class="labelName">Product Cost</div>';
          html += '<div class="item-input-wrap"><input class="productCost" type="text" placeholder="Product Cost" value="' + cost + '">';
          html +=  '<span class="input-clear-button"></span></div></div></div></div>';
          html += '<div class="col-50"><div class="item-content item-input no-padding-left"><div class="item-inner no-padding-right"><div class="labelName">Quantity</div>';
          html += '<div class="item-input-wrap"><input class="productQuantity" type="text" placeholder="Product Quantity" value="' + quantity + '">';
          html +=  '<span class="input-clear-button"></span></div></div></div></div></div>'; 
          html += '<div><span class="labelName">Discount: </span><div class="display-inline-flex"><input class="discount" type="text" placeholder="Discount" value="';
          html +=  discount + '"></div></div>';
          html += '<div><span class="labelName">Total Price: </span><div class="display-inline-flex"><input class="totalproductprice" type="text" placeholder="Total Price" value="';
          html +=  totalPrice + '"></div></div>';
        html += '</div><div class="card-footerMine padding-horizontal-half padding-bottom-half"><p class="display-inline-flex no-margin-vertical">';
          html += '<a class="button button-small button-raised removeProduct" data-id="' + select._id + '">Delete</a>';
        html += '</p></div></div>'
        html += '</li>';
        $("#products-list .sortList").append(html);
        $(".eachSaleParent .removeProduct").off("click").on("click", function(){
                  var id = $(this).attr("data-id");
                  self.RemoveItemProduct(id);
                  $(this).parents(".eachSaleParent").eq(0).remove();
                })
                $(".eachSaleParent input").off("keyup").on("keyup", function(){
                self.CalculateTotalProduct();
            })
                
    },
    getClients: function(){
        var self = this;
        var checked = 1;
        //var collection = db.products.where('status').equals(checked).toArray(function(arr){
        //var collection = db.ingredients.toArray(function(arr){
        //console.log(arr);
        dbClients.find({
          selector: {
            status: {$eq: checked}
          }
        }).then(function(ar){
          var arr = ar.docs;
          self.$setState({
                clients: arr
              })
        })
    },
    openPopUpMultiple:function(){
      var self = this;
      self.$setState({
        currentMultipleSale: null
      })
      //self.getProducts();
      var selectedValues = null;
            var autocompleteStandaloneMultiple = self.$app.autocomplete.create({
              openIn: 'popup', //open in page
              openerEl: '#autocomplete-standalone-multiple2', //link that opens autocomplete
              multiple: true, //allow multiple values
              navbarColorTheme: 'col bg-color-white text-color-black',
              preloader: true, //enable preloader
              valueProperty: '_id', //object's "value" property name
              textProperty: 'name_price', //object's "text" property name
              popupCloseLinkText: 'Done',
              requestSourceOnOpen:true,
              source: function (query, render) {
                var autocomplete = this;
                autocomplete.preloaderShow();
                var results = self.products.filter(x => x.status == 1); //.map(a => a.name);
                //autocomplete.preloaderHide();
                //render(results);
                if (query.length === 0) {
                  $.each(results, function(ind, val){
                      val["name_price"] = val["name"] + "\t" + " - " + self.formatMoney(val["selling_price"]);
                  })
                  autocomplete.preloaderHide();
                  render(results);
                  return;
                }
                
                if (query.length > 0) {
                  var newResult = [];
                  // Find matched items
                  for (var i = 0; i < results.length; i++) {
                    if (results[i].name.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
                        results[i].name_price = results[i].name + "\t" + " - " + self.formatMoney(results[i].selling_price);
                        newResult.push(results[i]);
                      }
                  }
                  // Render items by passing array with result items
                  autocomplete.preloaderHide();
                  render(newResult);
                }
              },
              on: {
                change: function (value) {
                  
                 var itemText = [], inputValue = [];
                 selectedValues = value;
                },
                closed: function(){
                  //console.log(selectedValues);
                  if(selectedValues == null || selectedValues.length == 0){
                    return;
                  }
                  for(var i = 0; i < selectedValues.length; i++){
                    /*var select = self.products.find(function(e){ 
                        return e.name == selectedValues[i].name;
                    });*/
                    var found = self.selectedProducts.filter(x => x._id == selectedValues[i]._id).length;
                    if(found < 1){
                      self.selectedProducts.push(selectedValues[i]);
                      self.SelectItemMultipleProducts(selectedValues[i]);
                    }
                  }
                  var deleted = self.selectedProducts.filter(function(x) {  // return elements in previousArray matching...
                      return !selectedValues.includes(x);  // "this element doesn't exist in currentArray"
                  })
                  for(var i = 0; i < deleted.length; i++){
                    $(".eachSaleParent .removeProduct[data-id='" + deleted[i]._id + "']").click()
                  }

                  selectedValues = null;
                  //autocomplete.destroy();
                  self.CalculateTotalProduct();
                }
              }
        });
        
        var taxes = self.settings == null ? 0 : self.settings.taxes;
        var taxesAmt = taxes == undefined ? 0 : taxes;
        $(".taxpercent").val(taxesAmt);
        $("#datePaidMultiple").val(moment().format('LLL'));
        $("#datePurchaseMultiple").val(moment().format('LLL'));
        //self.CalculateTotalProduct();
        var popup = self.$app.popup.open('.multipleSales', true);
    },
    openPopUpIngredients: function(id){
        var self = this;
        
        //popup.once("opened", function(){
            self.getDataIngredients(id);
            //console.log(self.ings);
            var selectedValues = null;
            var autocompleteStandaloneMultiple = self.$app.autocomplete.create({
              openIn: 'popup', //open in page
              openerEl: '#autocomplete-standalone-multiple', //link that opens autocomplete
              multiple: true, //allow multiple values
              navbarColorTheme: 'col bg-color-white text-color-black',
              preloader: true, //enable preloader
              valueProperty: '_id', //object's "value" property name
              textProperty: 'name_price', //object's "text" property name
              popupCloseLinkText: 'Done',
              requestSourceOnOpen:true,
              source: function (query, render) {
                var autocomplete = this;
                autocomplete.preloaderShow();
                var results = self.ings.filter(x => x.status == 1); //.map(a => a.name);
                
                //render(results);
                if (query.length === 0) {
                  $.each(results, function(ind, val){
                      val["name_price"] = val["name"] + "\t" + " - " + self.formatMoney(val["cost_per_unit"]) + " for " + val["unit_size"] + val["unit"];
                  })
                  autocomplete.preloaderHide();
                  render(results);
                  return;
                }
                if (query.length > 0) {
                  var newResult = [];
                  // Find matched items
                  for (var i = 0; i < results.length; i++) {
                    if (results[i].name.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
                        results[i].name_price = results[i].name + "\t" + " - " + self.formatMoney(results[i].cost_per_unit) + " for " + results[i].unit_size + results[i].unit;
                        newResult.push(results[i]);
                      }
                  }
                  // Render items by passing array with result items
                  autocomplete.preloaderHide();
                  render(newResult);
                }
              },
              on: {
                change: function (value) {
                  
                 selectedValues = value;
                 
                },
                closed: function(){
                  //console.log(selectedValues);
                  if(selectedValues == null || selectedValues.length == 0){
                    return;
                  }
                  for(var i = 0; i < selectedValues.length; i++){
                    /*var select = self.ings.find(function(e){ 
                        return e.name == selectedValues[i];
                    });*/
                    var found = self.productIngs.filter(x => x._id == selectedValues[i]._id).length;
                    if(found < 1){
                      self.productIngs.push(selectedValues[i]);
                      self.SelectItem(selectedValues[i]);
                    }
                  }
                  var deleted = self.productIngs.filter(function(x) {  // return elements in previousArray matching...
                      return !selectedValues.includes(x);  // "this element doesn't exist in currentArray"
                  })
                  for(var i = 0; i < deleted.length; i++){
                    $(".eachCostParent .removeCost[data-id='" + deleted[i]._id + "']").click()
                  }
                }
              }
        });
            var savearray = [];
            var profit = 0;
            if(id != null || id != undefined){
                //var collection = db.product_ingredient.where('productID').equals(Number(id)).toArray(function(arr){
                  //console.log(arr);
                  dbProdIngs.find({
                      selector: {
                        productID: {$eq: id}
                      }
                    }).then(function(ar){
                      var arr = ar.docs;
                      //console.log(arr);
                    $.each(arr, function( key, value ) {
                        //$(".ing-" + value.ingredientID).click();
                        //self.SelectItem(Number(value.ingredientID));
                        //console.log(value.ingredientID);
                        var each = self.activeArr.find(x => x._id == value.ingredientID);
                        if(each != undefined){
                          each.select_unit_size = value.unit_size;
                          each.select_cost = value.cost;
                          savearray.push(each);
                        }
                    })
                    //console.log(savearray);
                    self.$setState({
                        productIngs:savearray
                        //ings: self.ings
                    }, function(){
                        for(var i = 0; i < savearray.length; i++){
                          if(savearray[i] != undefined) self.SelectItem(savearray[i]);
                        }
                        self.CalculateTotal();
                    });
                    //self.CalculateTotal();
                }).then(function(){
                //var collection2 = db.product_otherMaterials.where('productID').equals(Number(id)).toArray(function(arr){
                  //console.log(arr);
                  dbProdOthers.find({
                      selector: {
                        productID: {$eq: id}
                      }
                    }).then(function(ar){
                    var arr = ar.docs;
                    //console.log(arr);
                  $.each(arr, function( key, value ) {
                    if(value.name != "***Profit***"){
                      var html = '<li class="extraCostRow"><div class="card myCard"><div class="card-content padding-horizontal-half">';
                        html += '<div><span class="labelName">Enter Name: </span><div class="display-inline-flex"><input class="extraName" type="text" placeholder="Enter Name" value="';
                        html +=  value.name + '"></div></div>';
                        html += '<div class="margin-top-half"><span class="labelName">Enter Cost: </span><div class="display-inline-flex"><input class="eachCost" type="text" placeholder="Enter Cost" value="';
                        html += value.cost + '"></div></div>';
                        html += '</div><div class="card-footerMine padding-horizontal-half padding-bottom-half"><p class="display-inline-flex no-margin-vertical">';
                          html += '<a class="button button-small button-raised removeRow">Delete</a>';
                        html += '</p></div></div>'
                        html += '</li>';
                        $("#prodOtherIng-list .sortList").append(html);
                      
                      $(".removeRow").on("click", function(e){
                          $(this).parents("li").eq(0).remove();
                          self.CalculateTotal();
                      })
                      $(".extraCostRow").find(".eachCost").on("keyup", function(e){
                          self.CalculateTotal();
                          //$(".calculateTotalButton").eq(0).click();
                      })
                    }else{
                            $(".profitvalue").val(value.cost);
                            profit = value.cost;
                        }
                    })
                    var prd = self.products.find(x => x._id == id);
                    var costPrice = Number(prd.cost_price);
                    var sellingPrice = Number(prd.selling_price);
                    $(".totalAmountBeforeProfit").text(costPrice.toFixed(2));
                    $(".totalAmount").text(sellingPrice.toFixed(2));
                    //var cent = (100 * profit)/(finalPrice - profit);
                    //$(".profitpercent").val(cent.toFixed(2));
                    //self.CalculateTotal();
                    var popup = self.$app.popup.open('.ProductIngredients', true);
                    //self.CalculateTotal();
                });
              });
            } 
            /*else{
              self.$setState({
                  currentProduct:null
              });
            }*/
        //})
        
    },
    saveMultipleProduct: function(){
        var self = this;
        var error = false;
        var bigData = [];
        
      //validation
      var grpName = $(".groupProductNameMultiple").val().trim();
        var buyername = $(".buyersNameMultiple").val().trim();
        var amountPaid = Number($(".amountPaidMultiple").val().trim());
        var taxes = Number($(".taxpercent").val().trim());
        if(isNaN(taxes)){
          error = true;
          $(".taxpercent").parents("ul").eq(0).addClass("bg-color-red");
        }else{
          $(".taxpercent").parents("ul").eq(0).removeClass("bg-color-red");
        }

        if(buyername == "" || isNaN(amountPaid)){
            $(".buyersNameMultiple").parents("li").eq(0).addClass("bg-color-red");
            error = true;
        }else{
          $(".buyersNameMultiple").parents("li").eq(0).removeClass("bg-color-red");
        }

        var beforeTaxes = Number($(".totalAmountBeforeProfitProduct").text());
          var afterTaxes = Number($(".totalAmountProduct").text());
          var fullyPaid = 0;
      var isPaidDate = null;
      if(amountPaid >= afterTaxes){
        fullyPaid = 1;
      }else{
        fullyPaid = 0;
      }
      isPaidDate = moment($("#datePaidMultiple").val()).format("X");//  Date.parse($("#paid-calendar-modal").val());
      var isEstimate = $(".isEstimateMultiple").prop("checked") == true ? 1 : 0;
        $(".eachProduct").each(function(i, curr){
        var productName = $(curr).find(".productName").eq(0).val().trim();
        var price = Number($(curr).find(".productCost").eq(0).val().trim());
        var quant = Number($(curr).find(".productQuantity").eq(0).val().trim());
        var totalPric = Number($(curr).find(".totalproductprice").eq(0).val().trim());
        var discount = Number($(curr).find(".discount").eq(0).val().trim());
        
        if(isNaN(price) || isNaN(quant) || productName == "" || isNaN(discount)){
            $(curr).addClass("bg-color-red");
            error = true;
        }else{
          $(curr).removeClass("bg-color-red");
          // saving logic
          var isParent = $(curr).hasClass("eachSaleParent") == true ? 1 : 0;
          var tax = (taxes/100) * totalPric;
          var costPlusTax = totalPric + tax;
          var obj = {
                product_name: productName,  
                buyer_name: buyername,
                selling_price: price,
                discount: discount,
                isEstimate: isEstimate,
                tax: taxes,
                parentID: 0,
                isParent: isParent,
                afterTax: costPlusTax,
                quantity: quant,
                total_price: totalPric,
                amountPaid:  0,
                isPaid: fullyPaid,
                date_paid: isPaidDate,
                created_date: moment($("#datePurchaseMultiple").val()).format("X"), //Date.parse($("#purchase-calendar-modal").val()),
                status:1
              };
            bigData.push(obj)
        }
      })

        // validation final
        if(error){
          self.showToast("Error is found in the forms!", "center");
          //console.log("error");
        }else{
          // save into db
          //console.log("clean");
          grpName = grpName == "" ? buyername + " group purchase" : grpName;
          
        var objMaster = {
                product_name: grpName,  
                buyer_name: buyername,
                selling_price: beforeTaxes,
                discount: 0,
                isEstimate: isEstimate,
                tax: taxes,
                parentID: 0,
                isParent:1,
                afterTax: afterTaxes,
                quantity: 1,
                total_price: beforeTaxes,
                amountPaid:  amountPaid,
                isPaid: fullyPaid,
                date_paid: isPaidDate,
                created_date: moment($("#datePurchaseMultiple").val()).format("X"), //Date.parse($("#purchase-calendar-modal").val()),
                status:1
              };
              var deleted = "";
              if(self.currentMultipleSale != null){
                objMaster._id = self.currentMultipleSale;
              }else{
                objMaster._id = moment().format("X");
              }

              //db.transaction('rw', db.sales, () => {
                  
                  dbSales.put(objMaster).then(function(res){
                      bigData.forEach((element, index) => {
                      bigData[index].parentID = res.id;
                      bigData[index]._id = index + moment().format("X");
                      deleted = res.id; 
                    });

                  if(self.currentMultipleSale != null){
                    dbSales.find({
                        selector: {
                          parentID: {$eq: deleted}
                        }
                      }).then(function(ar){
                        var arr = ar.docs;
                              arr.forEach((element, index) => {
                              arr[index]._deleted = true;
                          });
                          dbSales.bulkDocs(arr).then(function(){
                            dbSales.bulkDocs(bigData);
                          })
                      })
                      /*db.sales.where("parentID").equals(Number(self.currentMultipleSale)).delete()
                          .then(function (deleteCount) {
                              //console.log( "Deleted " + deleteCount + " objects");
                              db.sales.bulkAdd(bigData).then(function(lastKey) {
                                //console.log("Last allcost's id was: " + lastKey); // Will be 100000.
                                })
                          });*/
                  
                  }else{
                      dbSales.bulkDocs(bigData).then(function(lastKey) {
                          //console.log("Last allcost's id was: " + lastKey); // Will be 100000.
                    })
                  }
                  self.showToast("Saved successfully", "center");
                  self.closePopUpMultiple();
                  //self.$app.popup.close('.multipleSales', true);
                    
                }).catch(err => {
                  // Transaction aborted. NOT WITHIN ZONE!
                  //console.error (e);
                    self.showToast(err, "center");
                 });

              //saving clean data
          }
    },
    AddNewProduct: function(select){
      var self = this;
      var name = select == null ? "" : select.product_name;
      var cost = select == null ? "" : select.selling_price;
      var discount = select == null ? "0" : select.discount;
      var quantity = select == null ? 1 : select.quantity;
      var totalPrice = select == null ? "" : select.total_price;
        //var cost = select.cost == undefined ? 0 : select.cost; 
        var html = '<li class="eachSaleParentOther eachProduct"><div class="card myCard"><div class="card-content padding-horizontal-half">';
          html += '<div><span class="labelName">Product Name: </span><div class="display-inline-flex"><input class="productName" type="text" placeholder="Product Name" value="';
          html +=  name + '"></div></div>';
          html += '<div class="row"><div class="col-50"><div class="item-content item-input no-padding-left"><div class="item-inner no-padding-right"><div class="labelName">Product Cost</div>';
          html += '<div class="item-input-wrap"><input class="productCost" type="text" placeholder="Product Cost" value="' + cost + '">';
          html +=  '<span class="input-clear-button"></span></div></div></div></div>';
          html += '<div class="col-50"><div class="item-content item-input no-padding-left"><div class="item-inner no-padding-right"><div class="labelName">Quantity</div>';
          html += '<div class="item-input-wrap"><input class="productQuantity" type="text" placeholder="Product Quantity" value="' + quantity + '">';
          html +=  '<span class="input-clear-button"></span></div></div></div></div></div>';
          html += '<div><span class="labelName">Discount: </span><div class="display-inline-flex"><input class="discount" type="text" placeholder="Discount" value="';
          html +=  discount + '"></div></div>';
          html += '<div><span class="labelName">Total Price: </span><div class="display-inline-flex"><input class="totalproductprice" type="text" placeholder="Total Price" value="';
          html += totalPrice + '"></div></div>';
        html += '</div><div class="card-footerMine padding-horizontal-half padding-bottom-half"><p class="display-inline-flex no-margin-vertical">';
          html += '<a class="button button-small button-raised removeProduct">Delete</a>';
        html += '</p></div></div>'
        html += '</li>';
        $("#productsOther-list .sortList").append(html);
        $(".eachSaleParentOther .removeProduct").off("click").on("click", function(){
                  //var id = $(this).attr("data-itemid");
                  $(this).parents(".eachSaleParentOther").eq(0).remove();
                })
            $(".eachSaleParentOther input").off("keyup").on("keyup", function(){
                self.CalculateTotalProduct();
            })
    },
    CalculateTotalProduct: function(){
      var totalCost = 0;
      $(".eachProduct").each(function(i, curr){
        var price = Number($(curr).find(".productCost").eq(0).val().trim());
        var quant = Number($(curr).find(".productQuantity").eq(0).val().trim());
        var discount = Number($(curr).find(".discount").eq(0).val().trim());
        //$(curr).find(".totalproductprice")
        if(!isNaN(price) && !isNaN(quant)){
            var total = price * quant;
            total = total - discount;
            totalCost += total;
            $(curr).find(".totalproductprice").eq(0).val(total.toFixed(2));
        }
      })
      
      //console.log(totalCost);
      var tax = Number($(".multipleSales").find(".taxpercent").eq(0).val());
      if(!isNaN(tax) || tax == 0){
        $(".totalAmountBeforeProfitProduct").text(totalCost.toFixed(2));
          var taxAmt = ((tax/100) * totalCost);
          var afterTax = totalCost + taxAmt;
          $(".totalAmountProduct").text(afterTax.toFixed(2));
      }else{
        $(".totalAmountBeforeProfitProduct").text(totalCost.toFixed(2));
      }
    },
    closePopUpMultiple:function(){
      var self = this;
        var popup = self.$app.popup.close('.multipleSales', true);
        popup.once("closed", function(){
          $(".multipleSales .sortList li").remove();
          $(".buyersNameMultiple").parents("li").eq(0).removeClass("bg-color-red");
          $(".totalAmountBeforeProfitProduct, .totalAmountProduct").text("0");
          $(".amountPaidMultiple, .buyersNameMultiple, .groupProductNameMultiple").val("");
          $("#datePaidMultiple").val(moment().format('LLL'));
          $("#datePurchaseMultiple").val(moment().format('LLL'));
          self.$app.autocomplete.destroy("#autocomplete-standalone-multiple2");
            self.$setState({
                selectedProducts:[]
              });
            self.getData();
        });
    },
    closeEditProdPopUp: function(){
      var self = this;
      $$("input.name,input.selling_price,.cost_price").val("");
      var popup = self.$app.popup.close('.newProduct', true);
    },
    closePopUp: function(){
        var self = this;
        var popup = self.$app.popup.close('.ProductIngredients', true);
        $(".extraCostRow, .eachCostParent").remove();
            //$(".profitpercent").val("0");
            $(".totalAmount,.totalAmountBeforeProfit").text("");
            $(".profitvalue").val("0");
            self.$app.autocomplete.destroy("#autocomplete-standalone-multiple");
            //self.CalculateTotal();
        popup.once("closed", function(){
            self.$setState({
                  productIngs:null
              });
            self.getData();
        });
    },
    saveData: function(){
      //var $$ = this.Dom7;
      var self = this;
      var elem = $$("input:required");
      var err = self.$app.input.validateInputs(".productForm");
      //console.log(err);
      if(err){
        var textEditor = self.$app.textEditor.get('.desc_of_product');
        var desc = textEditor.value;
        var obj = {
                name: $$("input.name").val(),  
                desc: desc,
                cost_price: $("input.cost_price").val(),
                selling_price: $$("input.selling_price").val(), 
                status:1,
                created_date: moment().format("X")
              };
            if(self.currentProduct != null){
              obj._id = self.currentProduct._id;
              obj._rev = self.currentProduct._rev;
            }else{
              obj._id = moment().format("X");
            }
          dbProducts.put(obj).then(function(id) {
                  //self.$app.dialog.alert("Item saved.");
                  self.showToast("Item saved.", "center");
                  $$("input.name,input.selling_price,.cost_price").val("");
                  var textEditor = self.$app.textEditor.get('.desc_of_product');
                  textEditor.setValue("");
                  self.getData();
              })
          }
    },
    resetSalePopUp: function(){
      var self = this;
      $$("input.buyer_sell, input.amountpaid_sell, #purchase-calendar-modal, #paid-calendar-modal, .quantity_sell, .total_sell").val("");
      var popup = self.$app.popup.close('.sellProduct', true);
    },
    saveDataSell: function(){
      //var $$ = this.Dom7;
      var self = this;
      var checked = 0;
      //var toggle = self.$app.toggle.get(".paid_sell");
      var isPaidDate = null;
      /*if(toggle != undefined){
        checked = toggle.checked == true ? 1 : 0;
      }*/
      var isEstimate = $(".isEstimate").prop("checked");
      if($("#purchase-calendar-modal").val().trim() == ""){
        self.showToast("Please pick date of purchase", "center");
        return;
      }
      if($(".name_sell").val().trim() == ""){
        self.showToast("Please enter product name", "center");
        return;
      }
      if($(".cost_sell").val().trim() == ""){
        self.showToast("Please enter selling price", "center");
        return;
      }
      if($(".buyer_sell").val().trim() == ""){
        self.showToast("Please enter buyer's name", "center");
        return;
      }
      if(($("#paid-calendar-modal").val().trim() == "") && ($$("input.amountpaid_sell").val() != "0" && $$("input.amountpaid_sell").val().trim() != "")){
          self.showToast("Please choose date buyer paid!", "center");
          return;
      }
      if(($$("input.amountpaid_sell").val() == "0" || $$("input.amountpaid_sell").val().trim() == "") && isEstimate == false){
          self.$app.dialog.confirm("Do you want to record the purchase without a payment made?", function(){
            $$("input.amountpaid_sell").val(0);  
            self.processPayment();
          })
      }else{
        self.processPayment();
      }
    },
    processPayment: function(){
      var self = this;
      var cp = $$("input.afterTax").val();
      var sp = $$("input.amountpaid_sell").val();
      var fullyPaid = 0;
      var isPaidDate = null;
      if(Number(sp) >= Number(cp)){
        fullyPaid = 1;
      }else{
        fullyPaid = 0;
      }
      isPaidDate = moment($("#paid-calendar-modal").val()).format("X");//  Date.parse($("#paid-calendar-modal").val());
      var isEstimate = $(".isEstimate").prop("checked") == true ? 1 : 0; 
      var obj = {
                product_name: $$("input.name_sell").val(),  
                buyer_name: $$("input.buyer_sell").val(),
                selling_price: $$("input.cost_sell").val(),
                tax: $$("input.taxes").val(),
                parentID: 0,
                isParent:0,
                isEstimate: isEstimate,
                discount: $(".discount_sell").val(),
                afterTax: $$("input.afterTax").val(),
                quantity: $$("input.quantity_sell").val(),
                total_price: $$("input.total_sell").val(),
                amountPaid:  $$("input.amountpaid_sell").val(),
                isPaid: fullyPaid,
                date_paid: isPaidDate,
                created_date: moment($("#purchase-calendar-modal").val()).format("X"), //Date.parse($("#purchase-calendar-modal").val()),
                status:1,
                _id: moment().format("X")
              };
 
            dbSales.put(obj).then(function(){
                  self.showToast("Record saved!","center");
                  $$("input.buyer_sell, input.amountpaid_sell, #purchase-calendar-modal, #paid-calendar-modal, .quantity_sell, .total_sell, .discount_sell").val("");
                  $(".isEstimate").prop("checked", false);
                  self.$app.popup.close('.sellProduct', true);
                  
              }).catch(function (error) {
                  //console.log(error);
                 self.showToast("An error occurred!", "center");
              })
    },
    formatMoney:function(val){  
      var self = this;           
      var sym = self.settings == null ? "" : self.settings.currency;
      sym = sym == undefined ? "" : sym;
      val = Number(val);
      if(val < 0){
        var rev = 0 - val;
        var val2 = val + rev + rev;
        val = val2;
        sym = "-" + sym;
      }
      val = Math.round((val + Number.EPSILON) * 100) / 100;
      var ret = sym + val.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,");
      return ret;
    },
    getData: function(){
      var self = this;
      var checked = 1;
      var toggle = self.$app.toggle.get(".showInactive");
      if(toggle != undefined){
        checked = toggle.checked == true ? 0 : 1;
      }
      self.$app.preloader.show();
      dbProducts.find({
          selector: {
            status: {$eq: checked}
          }
        }).then(function(ar){
          var arr = ar.docs;
          self.$app.preloader.hide();
          self.$setState({
                products: arr,
                totalMat:arr.length
              }, function(){
                $("#product-list .list").empty();
                $("#product-list .pagination").remove();
                $(".sellMultiple").remove();
                      if(arr != null && arr.length > 0){
                        $(".sortTextPar").removeClass("display-none");
                        var pagination = "<ul class='pagination padding-left-half margin-vertical-half'><ul>";
                        $(pagination).insertAfter($("#product-list .list"));
                        $(".sort").remove();
                        var sorter = '<span class="sort" data-sort="name">Name</span><span class="sort" data-sort="cost">Cost</span>';
                        $(sorter).insertAfter($(".sortText"));
                        $(".sortText").removeClass("display-none");
                        var mult = "<div class='margin-horizontal-half margin-top-half'><a class='button button-raised sellMultiple'>Sell Multiple Products</div>";
                        $(mult).insertBefore($("#product-list .list"));
                        $(".sellMultiple").off("click").on("click", function(){
                          self.openPopUpMultiple();
                        })

                        for(var i = 0; i < arr.length; i++){
                            var row = arr[i];
                            var html = '<li><div class="card myCard"><div class="card-content padding-horizontal-half">';
                            html += '<div class="name cardName">' + row.name + '</div><div class="id display-none">' + row._id + '</div><div class="cost display-none">' + row.selling_price + '</div>';
                            if(row.desc != null && row.desc != ""){
                              html += '<div class=""><span class="labelName">Description: </span><span class="">' + row.desc + '</span></div>';
                            }
                            html += '<div class=""><span class="labelName">Selling Price: </span><span class="valueName">' + self.formatMoney(row.selling_price) + '</span></div>';
                            var stat = row.status == 1 ? "display-none" : "";
                            html += '<div class="' + stat + '"><span class="labelName">Status: </span><span class="valueName">Deleted</span></div>';
                            html += '</div><div class="card-footerMine padding-horizontal-half padding-bottom-half"><p class="display-inline-flex no-margin-vertical">';
                            html += '<a class="button button-small button-raised sellProduct" data-id="' + row._id + '">Sell</a>';
                            html += '<a class="button button-small button-raised editProduct" data-id="' + row._id + '">Edit</a>';
                            html += '<a class="button button-small button-raised addIngredients" data-id="' + row._id + '">Add/Edit Raw Materials</a>';
                            html += '<a class="button button-small button-raised deleteProduct" data-id="' + row._id + '">';
                            html +=  row.status == 1 ? 'Delete' : 'Activate';
                            html += '</a>';
                            if(row.status == 0){
                              html += '<a class="button button-small button-raised permDelButton" data-id="' + row._id + '">Delete</a>';
                            }
                            html += '</p></div></div></li>';
                            $("#product-list .list").append(html);
                            //return html;
                        }
                        var options = {
                            valueNames: ['id','cost','name'],
                            page: 5,
                            pagination: [{outerWindow:2}]
                        };

                        var productList = new List('product-list', options);

                        $(".sort").off("click").on("click", function(){
                          $(".sort").find(".asc").remove();
                          $(".sort").find(".desc").remove();
                            if($(this).hasClass("asc")){
                              $(this).append("<i class='icon f7-icons asc text-color-red'>arrowtriangle_up_fill</i>");
                            }
                            if($(this).hasClass("desc")){
                              $(this).append("<i class='icon f7-icons desc text-color-red'>arrowtriangle_down_fill</i>");
                            }
                        })
                      
                          $('#product-list').off("click").on('click','.button', function () {
                              var data = $(this).attr("data-id");
                              if($(this).hasClass("sellProduct")){
                                self.openPopUpSellProduct(data);
                              }
                              if($(this).hasClass("editProduct")){
                                self.openPopUp(data);
                              }
                              if($(this).hasClass("addIngredients")){
                                self.openPopUpIngredients(data);
                              }
                              if($(this).hasClass("deleteProduct")){
                                self.DeleteItem(productList,data);
                              }
                              if($(this).hasClass("permDelButton")){
                                self.permDeleteItem(productList, data);
                              }
                              //return false;
                          });
                        }else{
                          $(".sortTextPar").addClass("display-none");
                        }
                });
          }).catch(function(err){
            self.$app.preloader.hide();
          });
    },
    getDataIngredients: function(idOfProd){
      var self = this;
      var checked = 1;
      var toggle = self.$app.toggle.get(".showInactive");
      if(toggle != undefined){
        checked = toggle.checked == true ? 0 : 1;
      }

      dbIngs.allDocs({
          include_docs: true
        }).then(function(ar){
          //console.log(ar);
          var arr = ar.rows;
          var arr2 = arr.filter(x => (x.doc.status == 1 || x.doc.status == 0)).map(x => x.doc);
          var activeArr = arr.filter(x => x.doc.status == 1).map(x => x.doc);
        //var collection = db.ingredients.toArray(function(arr){
        //console.log(arr2);
          self.$setState({
                activeArr: activeArr,
                ings: arr2,
                totalMatIngredients:activeArr.length,
                productIngs:[],
                productToEdit: self.products.find(x => x._id == idOfProd).name,
                productToEditID: self.products.find(x => x._id == idOfProd)._id
              });
      });
    },
    AddNewCost: function(e){
      var self = this;
      var html = '<li class="extraCostRow"><div class="card myCard"><div class="card-content padding-horizontal-half">';
        html += '<div><span class="labelName">Enter Name: </span><div class="display-inline-flex"><input class="extraName" type="text" placeholder="Enter Name" ';
        html += '></div></div>';
        html += '<div class="margin-top-half"><span class="labelName">Enter Cost: </span><div class="display-inline-flex"><input class="eachCost" type="text" placeholder="Enter Cost" ';
        html += '></div></div>';
        html += '</div><div class="card-footerMine padding-horizontal-half padding-bottom-half"><p class="display-inline-flex no-margin-vertical">';
          html += '<a class="button button-small button-raised removeRow">Delete</a>';
        html += '</p></div></div>'
        html += '</li>';
        $("#prodOtherIng-list .sortList").append(html);
      
      $(".removeRow").on("click", function(e){
          $(this).parents("li").eq(0).remove();
          self.CalculateTotal();
      })
      $(".extraCostRow").find(".eachCost").on("keyup", function(e){
          self.CalculateTotal();
          //$(".calculateTotalButton").eq(0).click();
      })
    },
    startPouch: function(){
          var self = this;
          /*products: "++id,name,cost,status,created_date",
            product_ingredient: "++id,productID,ingredientID,unit_size,cost,status,created_date",
            product_otherMaterials: "++id,productID,name,cost,status,created_date",*/
            //sales: "++id,parentID,product_name,isParent,buyer_name,cost,quantity,tax,total_price,afterTax,amountPaid,isPaid,date_paid,created_date,status",
          try{//id,name,unit_size,unit,cost_per_unit,status,created_date
            if(pdf != undefined){
                dbProducts = new PouchDB('products.db', { adapter: 'cordova-sqlite' });
                dbProdIngs = new PouchDB('product_ingredients.db', { adapter: 'cordova-sqlite' });
                dbProdOthers = new PouchDB('product_otherMaterials.db', { adapter: 'cordova-sqlite' });
                dbSales = new PouchDB('sales.db', { adapter: 'cordova-sqlite' });
                dbIngs = new PouchDB('ingredients.db', { adapter: 'cordova-sqlite' });
                dbSettings = new PouchDB('settings.db', { adapter: 'cordova-sqlite' });
                dbClients = new PouchDB('clients.db', { adapter: 'cordova-sqlite' });
                dbClients.createIndex({
                  index: {
                    fields: ['name', 'created_date']
                  }
                })
                dbIngs.createIndex({
                  index: {
                    fields: ['name', 'status']
                  }
                })
                dbProdIngs.createIndex({
                  index: {
                    fields: ['productID', 'ingredientID', 'status']
                  }
                })
                dbProdOthers.createIndex({
                  index: {
                    fields: ['productID', 'name', 'status']
                  }
                })
                dbSales.createIndex({
                  index: {
                    fields: ['parentID', 'product_name', 'isParent', 'buyer_name', 'created_date', 'status']
                  }
                })
                dbProducts.createIndex({
                  index: {
                    fields: ['name', 'status']
                  }
                }).then(function (result) {
                  self.getData();
                  self.getClients();
                })
              }
          }catch(err){
                dbProducts = new PouchDB('products.db');
                dbProdIngs = new PouchDB('product_ingredients.db');
                dbProdOthers = new PouchDB('product_otherMaterials.db');
                dbSales = new PouchDB('sales.db');
                dbIngs = new PouchDB('ingredients.db');
                dbSettings = new PouchDB('settings.db');
                dbClients = new PouchDB('clients.db');
                dbClients.createIndex({
                  index: {
                    fields: ['name', 'created_date']
                  }
                })
                dbIngs.createIndex({
                  index: {
                    fields: ['name', 'status']
                  }
                })
                dbProdIngs.createIndex({
                  index: {
                    fields: ['productID', 'ingredientID', 'status']
                  }
                })
                dbProdOthers.createIndex({
                  index: {
                    fields: ['productID', 'name', 'status']
                  }
                })
                dbSales.createIndex({
                  index: {
                    fields: ['parentID', 'product_name', 'isParent', 'buyer_name', 'created_date', 'status']
                  }
                })
                dbProducts.createIndex({
                  index: {
                    fields: ['name', 'status']
                  }
                }).then(function (result) {
                  self.getData();
                  self.getClients();
                })
          }
          var id = self.settingsID;
            dbSettings.get(id).then(function(doc) {
              //console.log(doc);
                  self.$setState({
                      settings: doc
                    })
              })
        },
    SaveTotal: function(){
      var self = this;
      var allCost = [];
      var allExtraCost = [];
      var passed = true;
      if($(".extraCostRow").length == 0 && $(".eachCostParent").length == 0){
          self.$app.dialog.alert("Please choose raw materials to save!");
          return false;
      }
      $(".eachCostParent").each(function(index,item){
          var cost = $(item).find(".eachCost").eq(0).text();
          var val = $(item).find(".costvalue").eq(0).val();
          var ingID = $(item).find(".removeCost").eq(0).attr("data-id");
          if((cost == "" || cost == "0") || (val == "")){
              self.$app.dialog.alert("Please fill all fields or remove unused selected raw materials");
              passed = false;
              return false;
          }else{
            var obj = {};
            obj.productID = self.productToEditID;
            obj.ingredientID = ingID;
            obj.unit_size = Number(val);
            obj.cost = Number(cost);
            obj.status = 1;
            obj.created_date = moment().format("X");
            obj._id = index + moment().format("X");
            allCost.push(obj);
          }
      })

      if(passed){
          $(".extraCostRow").each(function(index,item){
              var extraname = $(item).find(".extraName").val().trim();
              var extracost = $(item).find(".eachCost").val().trim();
              if(extraname == "" || extracost == ""){
                  self.$app.dialog.alert("Please fill all fields or remove unused for custom charges");
                  passed = false;
                  return false;
              }else{
                var obj = {};
                obj.productID = self.productToEditID;
                obj.name = extraname;
                obj.cost = Number(extracost);
                obj.status = 1;
                obj.created_date = moment().format("X");
                obj._id = index + moment().format("X");
                allExtraCost.push(obj);
              }
          })
      }
          if(passed){
                var obj = {};
                obj.productID = self.productToEditID;
                obj.name = "***Profit***";
                obj.cost = Number($(".profitvalue").val());
                obj.status = 1;
                obj.created_date = moment().format("X");
                allExtraCost.push(obj);
          }
          //record in db
          if(passed){
                //console.log(allCost);
                //console.log(allExtraCost);
                var total1 = Number($(".totalAmountBeforeProfit").text());
                var total2 = Number($(".totalAmount").text());
                //console.log(totall);
                //db.transaction('rw', db.product_ingredient, db.product_otherMaterials, db.products, () => {
                  
                      /*db.product_ingredient.where("productID").equals(self.productToEditID).delete()
                      .then(function (deleteCount) {
                            //console.log( "Deleted " + deleteCount + " objects");
                          });*/
                          dbProdIngs.find({
                            selector: {
                              productID: {$eq: self.productToEditID}
                            }
                          }).then(function(ar){
                            var arr = ar.docs;
                                  arr.forEach((element, index) => {
                                  arr[index]._deleted = true;
                              });
                              //console.log(arr);
                              dbProdIngs.bulkDocs(arr).then(function(){
                                dbProdIngs.bulkDocs(allCost);
                              })
                          

                          dbProdOthers.find({
                            selector: {
                              productID: {$eq: self.productToEditID}
                            }
                          }).then(function(ar1){
                            //console.log(ar1);
                            var arr2 = ar1.docs;
                                  arr2.forEach((element, index) => {
                                  arr2[index]._deleted = true;
                              });
                              //console.log(arr2);
                              dbProdOthers.bulkDocs(arr2).then(function(){
                                dbProdOthers.bulkDocs(allExtraCost);
                              })
                          })

                          dbProducts.get(self.productToEditID).then(function(doc) {
                          // console.log(doc);
                            doc.cost_price = total1;
                            doc.selling_price = total2;
                            return dbProducts.put(doc);
                          })

                          /*db.product_otherMaterials.where("productID").equals(self.productToEditID).delete()
                          .then(function (deleteCount) {
                              //console.log( "Deleted " + deleteCount + " objects");
                            });
                              //console.log(allCost);
                              db.product_ingredient.bulkAdd(allCost).then(function(lastKey) {
                                      //console.log("Last allcost's id was: " + lastKey); // Will be 100000.
                                  }).catch(Dexie.BulkError, function (e) {
                                      passed = false;
                                  });

                                  //console.log(allExtraCost);
                                  db.product_otherMaterials.bulkAdd(allExtraCost).then(function(lastKey) {
                                     // console.log("Last extracost's id was: " + lastKey); // Will be 100000.
                                  }).catch(Dexie.BulkError, function (e) {
                                      passed = false;
                                  });*/
                                  
                                /*db.products.update(self.productToEditID, {cost: totall}).then(function (updated) {
                                  if (updated){
                                    //console.log ("Product price " + self.productToEditID + " was changed to " + totall);
                                  }else{
                                    passed = false;
                                    //console.log ("Nothing was updated - there were no friend with primary key: 2");
                                  }
                                    
                                });*/
                      
                        //}).then(() => {
                            // Transaction committed. NOT WITHIN ZONE!
                            self.showToast("Saved successfully", "center");
                            self.closePopUp();
                            //self.$app.popup.close('.ProductIngredients', true);
                        }).catch(err => {

                            // Transaction aborted. NOT WITHIN ZONE!
                            //console.error (e);
                            self.showToast("An error occured, please try again");
                        });
               /* if(passed){
                  self.$app.dialog.alert("Saved successfully");
                }*/
          }
                
          
      }

  },
  on: {
      pageInit: function(e, page) {
        var self = this;
        var iconTooltip = self.$app.tooltip.create({
          targetEl: '.estimateExplain',
          text: '<b>Check if this is just an estimate,</b><br><b>no purchase is being made yet.</b>',
        });
        var autocompleteDropdownBuyer = self.$app.autocomplete.create({
          inputEl: '#buyer_sell',//buyersNameMultiple
          openIn: 'dropdown',
          valueProperty: '_id', //object's "value" property name
          textProperty: 'name', //object's "text" property name
          source: function (query, render) {
            var results = self.clients.filter(x => x.status == 1);
            var newResult = [];
            // Find matched items
            for (var i = 0; i < self.clients.length; i++) {
              if (results[i].name.toLowerCase().indexOf(query.toLowerCase()) >= 0) newResult.push(results[i]);
            }
            // Render items by passing array with result items
            render(newResult);
          },
          on: {
                change: function (value) {
                  if(value.length > 0){
                  value = value[0];
                  
                  $("#buyer_sell").val(value.name);
                  }
                }
              }
        });
        var autocompleteDropdownMultipleBuyer = self.$app.autocomplete.create({
          inputEl: '#buyersNameMultiple',//buyersNameMultiple
          openIn: 'dropdown',
          valueProperty: '_id', //object's "value" property name
          textProperty: 'name', //object's "text" property name
          source: function (query, render) {
            var results = self.clients.filter(x => x.status == 1);
            var newResult = [];
            // Find matched items
            for (var i = 0; i < self.clients.length; i++) {
              if (results[i].name.toLowerCase().indexOf(query.toLowerCase()) >= 0) newResult.push(results[i]);
            }
            // Render items by passing array with result items
            render(newResult);
          },
          on: {
                change: function (value) {
                  if(value.length > 0){
                  value = value[0];
                  $("#buyersNameMultiple").val(value.name);
                  }
                }
              }
        });
        var calendar1 = self.$app.calendar.create({
                  inputEl: '#datePaidMultiple',
                  timePicker: true,
                  closeOnSelect: true,
                  formatValue: function(values){
                    //console.log(values[0]);
                    var t = moment(values[0]).format('LLL');
                    //console.log(moment(values[0]).format("X"));
                    //console.log(t);
                    return t;
                  }
                  //dateFormat: { month: 'numeric', day: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric' }
              });

              var calendar2 = self.$app.calendar.create({
                  inputEl: '#datePurchaseMultiple',
                  timePicker: true,
                  closeOnSelect: true,
                  formatValue: function(values){
                    //console.log(values[0]);
                    var t = moment(values[0]).format('LLL');
                    //console.log(moment(values[0]).format("X"));
                    //console.log(t);
                    return t;
                  }
                  //dateFormat: { month: 'numeric', day: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric' }
              });
        var calendar = self.$app.calendar.create({
                  inputEl: '#paid-calendar-modal',
                  timePicker: true,
                  closeOnSelect: true,
                  formatValue: function(values){
                    //console.log(values[0]);
                    var t = moment(values[0]).format('LLL');
                    //console.log(moment(values[0]).format("X"));
                    //console.log(t);
                    return t;
                  }
                  //dateFormat: { month: 'numeric', day: 'numeric', year: 'numeric', hour: 'numeric', minute: 'numeric' }
              });

              var calendarPurchase = self.$app.calendar.create({
                  inputEl: '#purchase-calendar-modal',
                  timePicker: true,
                  closeOnSelect: true,
                  formatValue: function(values){
                    //console.log(values[0]);
                    var t = moment(values[0]).format('LLL');
                    //console.log(moment(values[0]).format("X"));
                    //console.log(t);
                    return t;
                  }
                  //dateFormat: 'YYYY-MM-DD HH:MM'
                  //dateFormat: { year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric' }
              });

              var textEditorCustomButtons = self.$app.textEditor.create({
                  el: '.desc_of_product',
                  buttons: [["bold", "italic", "underline", 'h1', 'h2', 'h3', 'orderedList', 'unorderedList']],
                  on: {
                    buttonClick: function (editor, button) {
                        var act = $('button[data-button="' + button + '"]').hasClass("active");
                        if(act){
                          $('button[data-button="' + button + '"]').removeClass("active");
                        }else{
                          $('button[data-button="' + button + '"]').addClass("active");
                        }
                      }
                    }
                });
        $$(".showInactive").on("change", function(){
            self.getData();
        })
        self.startPouch();
      }
  }

} 
</script>